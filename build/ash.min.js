/**
 * almond 0.2.3 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 0.7.4 - Build: 252 (2012/02/24 10:30 PM)
 */

(function(e,t){var n=e.define,r,i,t;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var r=f[t];delete f[t],c[t]=!0,n.apply(e,r)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var n,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},n=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},r=i=s=function(t,r,i,a,f){return typeof t=="string"?u[t]?u[t](r):b(o(t,r).f):(t.splice||(l=t,r.splice?(t=r,r=i,i=null):t=e),r=r||function(){},typeof i=="function"&&(i=a,a=f),a?n(e,t,r,i):setTimeout(function(){n(e,t,r,i)},15),s)},s.config=function(e){return l=e,s},t=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},t.amd={jQuery:!0}})(),t("lib/vendor/almond",function(){}),t("brejep/class",[],function(){var e={extend:function(t){var n=this.prototype||e,r=Object.create(n);e.copyOwnTo(t,r);var i=r.constructor;if(i instanceof Function)return i.prototype=r,i.super=n,i.extend=this.extend,i;throw new Error("You must define a method 'constructor'")},copyOwnTo:function(e,t){return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}};return e}),t("ash-core/family",["brejep/class"],function(e){var t=e.extend({nodes:null,constructor:function(e,t){this.__defineGetter__("nodeList",function(){return this.nodes})},newEntity:function(e){throw new Error("should be overriden")},removeEntity:function(e){throw new Error("should be overriden")},componentAddedToEntity:function(e,t){throw new Error("should be overriden")},componentRemovedFromEntity:function(e,t){throw new Error("should be overriden")},cleanUp:function(){throw new Error("should be overriden")}});return t}),t("ash-core/nodepool",["brejep/class"],function(e){var t=e.extend({tail:null,cacheTail:null,nodeClass:null,components:null,constructor:function(e,t){this.nodeClass=e,this.components=t},get:function(){if(this.tail){var e=this.tail;return this.tail=this.tail.previous,e.previous=null,e}return new this.nodeClass},dispose:function(e){this.components.forEach(function(t,n){e[n]=null}),e.entity=null,e.next=null,e.previous=this.tail,this.tail=e},cache:function(e){e.previous=this.cacheTail,this.cacheTail=e},releaseCache:function(){while(this.cacheTail){var e=this.cacheTail;this.cacheTail=e.previous,this.dispose(e)}}});return t}),function(e){function r(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function i(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}var n={VERSION:"0.7.4"};r.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.Signal=function(){this._bindings=[],this._prevParams=null},n.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,i){var s=this._indexOfListener(e,n),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else o=new r(this,e,t,n,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,n){return i(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return i(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){i(e,"remove");var n=this._indexOfListener(e,t);return n!==-1&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},typeof t=="function"&&t.amd?t("signals",n):typeof module!="undefined"&&module.exports?module.exports=n:e.signals=n}(this),t("ash-core/nodelist",["signals","brejep/class"],function(e,t){var n=t.extend({constructor:function(){this.head=null,this.tail=null,this.nodeAdded=new e.Signal,this.nodeRemoved=new e.Signal},add:function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e,this.nodeAdded.dispatch(e)},remove:function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodeRemoved.dispatch(e)},removeAll:function(){while(this.head){var e=this.head;this.head=e.next,e.previous=null,e.next=null,this.nodeRemoved.dispatch(e)}this.tail=null},empty:function(){return this.head===null},swap:function(e,t){if(e.previous==t)e.previous=t.previous,t.previous=e,t.next=e.next,e.next=t;else if(t.previous==e)t.previous=e.previous,e.previous=t,e.next=t.next,t.next=e;else{var n=e.previous;e.previous=t.previous,t.previous=n,n=e.next,e.next=t.next,t.next=n}this.head==e?this.head=t:this.head==t&&(this.head=e),this.tail==e?this.tail=t:this.tail==t&&(this.tail=e),e.previous&&(e.previous.next=e),t.previous&&(t.previous.next=t),e.next&&(e.next.previous=e),t.next&&(t.next.previous=t)},insertionSort:function(e){if(this.head==this.tail)return;var t=this.head.next;for(var n=t;n;n=t){t=n.next;for(var r=n.previous;r;r=r.previous)if(e(n,r)>=0){n!=r.next&&(this.tail==n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=r.next,n.previous=r,n.next.previous=n,r.next=n);break}r||(this.tail==n&&(this.tail=n.previous),n.previous.next=n.next,n.next&&(n.next.previous=n.previous),n.next=this.head,this.head.previous=n,n.previous=null,this.head=n)}},mergeSort:function(e){if(this.head==this.tail)return;var t=[],n=this.head,r;while(n){r=n;while(r.next&&e(r,r.next)<=0)r=r.next;var i=r.next;n.previous=r.next=null,t.push(n),n=i}while(t.length>1)t.push(this.merge(t.shift(),t.shift(),e));this.tail=this.head=t[0];while(this.tail.next)this.tail=this.tail.next},merge:function(e,t,n){var r,i;n(e,t)<=0?(i=r=e,e=e.next):(i=r=t,t=t.next);while(e&&t)n(e,t)<=0?(r.next=e,e.previous=r,r=e,e=e.next):(r.next=t,t.previous=r,r=t,t=t.next);return e?(r.next=e,e.previous=r):(r.next=t,t.previous=r),i}});return n}),t("brejep/dictionary",["brejep/class"],function(e){var t=e.extend({VERSION:"0.1.0",keys:null,values:null,constructor:function(){return this.keys=[],this.values=[],this},add:function(e,t){var n=this.getIndex(e);n>=0?this.values[n]=t:(this.keys.push(e),this.values.push(t))},remove:function(e){var t=this.getIndex(e);if(!(t>=0))throw"Key does not exist";this.keys.splice(t,1),this.values.splice(t,1)},retrieve:function(e){var t=null,n=this.getIndex(e);return n>=0&&(t=this.values[n]),t},getIndex:function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return t}return-1},has:function(e){var t=0,n=this.keys.length,r;for(;t<n;++t){r=this.keys[t];if(r==e)return!0}return!1},forEach:function(e){var t=0,n=this.keys.length,r,i;for(;t<n;++t){r=this.keys[t],i=this.values[t];var s=e(r,i);if(s==="return")return!1}return!0}});return t}),t("ash-core/componentmatchingfamily",["ash-core/family","ash-core/nodepool","ash-core/nodelist","brejep/dictionary"],function(e,t,n,r){var i=e.extend({constructor:function(e,i){this.nodeClass=e,this.engine=i,this.__defineGetter__("nodeList",function(){return this.nodes}),this.nodes=new n,this.entities=new r,this.components=new r,this.nodePool=new t(this.nodeClass,this.components),this.nodePool.dispose(this.nodePool.get());var s=this.nodeClass.prototype;for(var o in s)if(s.hasOwnProperty(o)&&o!="types"&&o!="next"&&o!="previous"&&o!="constructor"&&o!="super"&&o!="extend"&&o!="entity"){var u=s.types[o];this.components.add(u,o)}},newEntity:function(e){this.addIfMatch(e)},componentAddedToEntity:function(e,t){this.addIfMatch(e)},componentRemovedFromEntity:function(e,t){this.components.has(t)&&this.removeIfMatch(e)},removeEntity:function(e){this.removeIfMatch(e)},cleanUp:function(){for(var e=this.nodes.head;e;e=e.next)this.entities.remove(e.entity);this.nodes.removeAll()},addIfMatch:function(e){if(!this.entities.has(e)){var t;if(!this.components.forEach(function(t,n){if(!e.has(t))return"return"}))return;var n=this.nodePool.get();n.entity=e,this.components.forEach(function(t,r){n[r]=e.get(t)}),this.entities.add(e,n),e.componentRemoved.add(this.componentRemovedFromEntity,this),this.nodes.add(n)}},removeIfMatch:function(e){var t=this.entities,n=this.nodes,r=this.engine,i=this.nodePool;if(t.has(e)){var s=t.retrieve(e);e.componentRemoved.remove(this.componentRemovedFromEntity,this),t.remove(e),n.remove(s),r.updating?(i.cache(s),r.updateComplete.add(this.releaseNodePoolCache,this)):i.dispose(s)}},releaseNodePoolCache:function(){this.engine.updateComplete.remove(this.releaseNodePoolCache),this.nodePool.releaseCache()}});return i}),t("ash-core/entitylist",["brejep/class"],function(e){var t=e.extend({head:null,tail:null,constructor:function(){},add:function(e){this.head?(this.tail.next=e,e.previous=this.tail,this.tail=e):this.head=this.tail=e},remove:function(e){this.head==e&&(this.head=this.head.next),this.tail==e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},removeAll:function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null}});return t}),t("ash-core/systemlist",["brejep/class"],function(e){var t=e.extend({head:null,tail:null,constructor:function(){},add:function(e){if(!this.head)this.head=this.tail=e,e.next=e.previous=null;else{for(var t=this.tail;t;t=t.previous)if(t.priority<=e.priority)break;t===this.tail?(this.tail.next=e,e.previous=this.tail,e.next=null,this.tail=e):t?(e.next=t.next,e.previous=t,t.next.previous=e,t.next=e):(e.next=this.head,e.previous=null,this.head.previous=e,this.head=e)}},remove:function(e){this.head===e&&(this.head=this.head.next),this.tail===e&&(this.tail=this.tail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous)},removeAll:function(){while(this.head){var e=this.head;this.head=this.head.next,e.previous=null,e.next=null}this.tail=null},get:function(e){for(var t=this.head;t;t=t.next)if(t.is(e))return t;return null}});return t}),t("ash-core/engine",["ash-core/componentmatchingfamily","ash-core/entitylist","ash-core/systemlist","signals","brejep/dictionary","brejep/class"],function(e,t,n,r,i,s){var o=s.extend({familyClass:e,families:null,entityList:null,systemList:null,updating:!1,updateComplete:new r.Signal,constructor:function(){this.entityList=new t,this.systemList=new n,this.families=new i,this.__defineGetter__("entities",function(){var e=[];for(var t=this.entityList.head;t;t=t.next)e.push(t);return e}),this.__defineGetter__("systems",function(){var e=[];for(var t=this.systemList.head;t;t=t.next)e.push(t);return e})},addEntity:function(e){this.entityList.add(e),e.componentAdded.add(this.componentAdded,this),this.families.forEach(function(t,n){n.newEntity(e)})},removeEntity:function(e){e.componentAdded.remove(this.componentAdded,this),this.families.forEach(function(t,n){n.removeEntity(e)}),this.entityList.remove(e)},removeAllEntities:function(){while(this.entityList.head)this.removeEntity(this.entityList.head)},componentAdded:function(e,t){this.families.forEach(function(n,r){r.componentAddedToEntity(e,t)})},getNodeList:function(e){if(this.families.has(e))return this.families.retrieve(e).nodes;var t=new this.familyClass(e,this);this.families.add(e,t);for(var n=this.entityList.head;n;n=n.next)t.newEntity(n);return t.nodes},releaseNodeList:function(e){this.families.has(e)&&this.families.retrieve(e).cleanUp(),this.families.remove(e)},addSystem:function(e,t){e.priority=t,e.addToEngine(this),this.systemList.add(e)},getSystem:function(e){return this.systemList.get(e)},removeSystem:function(e){this.systemList.remove(e),e.removeFromEngine(this)},removeAllSystems:function(){while(this.systemList.head)this.removeSystem(this.systemList.head)},update:function(e){this.updating=!0;for(var t=this.systemList.head;t;t=t.next)t.update(e);this.updating=!1,this.updateComplete.dispatch()}});return o}),t("ash-core/entity",["signals","brejep/dictionary","brejep/class"],function(e,t,n){var r=n.extend({previous:null,next:null,components:null,constructor:function(){this.components=new t,this.componentAdded=new e.Signal,this.componentRemoved=new e.Signal},add:function(e,t){return typeof t=="undefined"&&(t=e.constructor),this.components.has(t)&&this.remove(t),this.components.add(t,e),this.componentAdded.dispatch(this,t),this},remove:function(e){var t=this.components.retrieve(e);return t?(this.components.remove(e),this.componentRemoved.dispatch(this,e),t):null},get:function(e){return this.components.retrieve(e)},getAll:function(){var e=[];return this.components.forEach(function(t,n){e.push(n)}),e},has:function(e){return this.components.has(e)}});return r}),t("ash-core/node",["brejep/class"],function(e){var t=e.extend({entity:null,previous:null,next:null,constructor:function(){}});return t.create=function(e){var n={types:{},constructor:function(){}};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];i&&(n.types[r]=i),n[r]=null}return t.extend(n)},t}),t("ash-core/system",["brejep/class"],function(e){var t=e.extend({previous:null,next:null,priority:0,constructor:function(){},addToEngine:function(e){},removeFromEngine:function(e){},update:function(e){},is:function(e){return e.prototype.isPrototypeOf(this)}});return t}),t("ash/ash-framework",["require","ash-core/engine","ash-core/componentmatchingfamily","ash-core/entity","ash-core/entitylist","ash-core/family","ash-core/node","ash-core/nodelist","ash-core/nodepool","ash-core/system","ash-core/systemlist","brejep/class","signals"],function(e){var t={VERSION:"0.2.0"};return t.Engine=e("ash-core/engine"),t.ComponentMatchingFamily=e("ash-core/componentmatchingfamily"),t.Entity=e("ash-core/entity"),t.EntityList=e("ash-core/entitylist"),t.Family=e("ash-core/family"),t.Node=e("ash-core/node"),t.NodeList=e("ash-core/nodelist"),t.NodePool=e("ash-core/nodepool"),t.System=e("ash-core/system"),t.SystemList=e("ash-core/systemlist"),t.Class=e("brejep/class"),t.Signals=e("signals"),t});var s=i("ash/ash-framework");typeof module!="undefined"&&module.exports?module.exports=s:n?function(e){e(function(){return s})}(n):e.Ash=s})(this);